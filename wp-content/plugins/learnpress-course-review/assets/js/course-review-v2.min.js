const showPopupWriteReview=()=>{let e=document.querySelector("button.write-a-review");null!==e&&e.addEventListener("click",e=>{e.preventDefault();let t=document.querySelector(".course-review-wrapper");t&&(addReviewStar(),t.classList.add("active"))})},closePopupWriteReview=()=>{let e=document.querySelectorAll("#review-form .close");if(null===e)return;let t=document.querySelector(".course-review-wrapper");if(t)for(let r=0;r<e.length;r++){let l=e[r];l.addEventListener("click",e=>{e.preventDefault(),t.classList.remove("active")})}},addReviewStar=()=>{let e=document.querySelector(".review-form");if(!e)return;let t=e.querySelector("ul.review-stars");if(!t)return;let r=t.querySelectorAll("li.review-title"),l=!1,a=(e,t)=>{[...e].map(e=>{let r=e.getAttribute("title");r<=t?e.querySelector("span").classList.add("hover"):e.querySelector("span").classList.remove("hover")})};r&&r.forEach((e,t)=>{let i=e.getAttribute("title");e.addEventListener("mouseover",()=>{l||a(r,i)}),e.addEventListener("click",()=>{console.log("object"),l=!0,a(r,i),document.querySelector('ul.review-fields li.review-actions input[name="rating"]').value=i})}),t.addEventListener("mouseout",()=>{r.forEach(e=>{l||e.querySelector("span").classList.remove("hover")})}),closePopupWriteReview()},courseReviewSkeleton=()=>{let e=()=>{let e=document.querySelector(".learnpress-course-review");if(!e)return;let r=e.dataset.id;t(e,r)},t=async(e,t=0)=>{let r=e.querySelector(".lp-skeleton-animation");try{let l=await wp.apiFetch({path:"lp/v1/review/rating-comment/course/"+t,method:"GET"}),{data:a,status:i,message:s}=l;if("error"===i)throw Error(s||"Error");a&&e.insertAdjacentHTML("beforeend",a)}catch(o){e.insertAdjacentHTML("beforeend",`<div class="lp-ajax-message error" style="display:block">${o.message||"Error: Query lp/v1/lazy-load/course-review"}</div>`)}r&&r.remove(),showPopupWriteReview(),closePopupWriteReview();let c=document.querySelectorAll(".review-stars-rated");c&&c.forEach(e=>{e.style.display="flex"});let n=document.querySelectorAll(".review-stars-rated");n&&c.forEach(e=>{e.style.position="relative"})};e();let r=async e=>{let t=e.closest("form"),r=t.querySelector("ul.review-fields");if(!r)return;let l=r.querySelector('input[name="review_title"]').value||"",a=r.querySelector('textarea[name="review_content"]').value||"",i=r.querySelector('input[name="rating"]').value,s=e.dataset.id,o=r.querySelector('input[name="empty_title"]').value,c=r.querySelector('input[name="empty_content"]').value,n=r.querySelector('input[name="empty_rating"]').value;if(0===l.length){alert(o);return}if(0===a.length){alert(c);return}if(0===i){alert(n);return}e.classList.add("loading");try{let u=await wp.apiFetch({path:"lp/v1/review/submit",method:"POST",data:{id:s,rate:i,title:l,content:a}}),{status:d,message:v}=u;"success"===d?(e.classList.remove("loading"),window.location.reload()):r.innerHTML+=`<li class="lp-ajax-message error" style="display:block">${v}</li>`}catch(p){r.innerHTML+=`<li class="lp-ajax-message error" style="display:block">${p}</li>`}},l=async(e,t,r,l=!1)=>{try{let a=await wp.apiFetch({path:"lp/v1/review/course/"+t+"/?page="+r+"&show_template=1",method:"GET"});if("success"===a.status&&a.data?e.innerHTML+=a.data.template:e.innerHTML+=`<li class="lp-ajax-message error" style="display:block">${a.message&&a.message}</li>`,l){l.classList.remove("loading");let i=l.dataset.paged,s=l.dataset.number;s<=i&&l.remove(),l.dataset.paged=parseInt(i)+1}let o=document.querySelectorAll(".review-stars-rated");o&&o.forEach(e=>{e.style.display="flex"})}catch(c){e.innerHTML+=`<li class="lp-ajax-message error" style="display:block">${c}</li>`}};document.addEventListener("click",function(e){let t=document.querySelector(".course-review-load-more");if(t&&t.contains(e.target)){t.classList.add("loading");let a=t&&t.dataset.paged,i=t&&t.dataset.id,s=document.querySelector(".course-reviews-list");l(s,i,a,t)}let o=document.querySelector("li.review-actions .submit-review");o&&o.contains(e.target)&&r(o)})};document.addEventListener("DOMContentLoaded",function(){courseReviewSkeleton(),showPopupWriteReview()});
